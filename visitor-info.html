<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Secure Visitor Information</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
    margin: 0;
    font-family: 'Segoe UI', sans-serif;
    background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
    color: #fff;
    min-height: 100vh;
}

.container {
    max-width: 900px;
    margin: auto;
    padding: 30px;
}

.card {
    background: rgba(255,255,255,0.1);
    backdrop-filter: blur(10px);
    border-radius: 15px;
    padding: 25px;
    margin-top: 40px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.4);
}

h1, h2 {
    text-align: center;
}

input, button {
    width: 100%;
    padding: 12px;
    margin-top: 10px;
    border-radius: 8px;
    border: none;
    font-size: 16px;
}

input {
    background: #fff;
}

button {
    background: #00c6ff;
    color: #000;
    font-weight: bold;
    cursor: pointer;
}

button:hover {
    background: #00aaff;
}

ul {
    list-style: none;
    padding: 0;
}

li {
    padding: 6px 0;
    border-bottom: 1px solid rgba(255,255,255,0.2);
}

.hidden {
    display: none;
}

.success {
    color: #00ffcc;
    text-align: center;
}

.error {
    color: #ff6b6b;
    text-align: center;
}
</style>
</head>

<body>

<div class="container">

<!-- ðŸ” LOGIN CARD -->
<div id="loginCard" class="card">
    <h1>Secure Access</h1>
    <input type="text" id="userid" placeholder="User ID">
    <input type="password" id="password" placeholder="Password">
    <button onclick="login()">Login</button>
    <p id="loginMsg" class="error"></p>
</div>

<!-- ðŸ“Š VISITOR INFO -->
<div id="infoCard" class="card hidden">
    <h1>Visitor Information</h1>
    <div id="info"></div>

    <button onclick="downloadCSV()">Download CSV</button>
    <button onclick="window.location.href='index.html'">Back to Home</button>
</div>

</div>

<script>
/* ================= LOGIN ================= */
function login() {
    const user = document.getElementById("userid").value.trim();
    const pass = document.getElementById("password").value.trim();

    if (user === "New" && pass === "Admin") {
        document.getElementById("loginCard").classList.add("hidden");
        document.getElementById("infoCard").classList.remove("hidden");
        loadInfo();
    } else {
        document.getElementById("loginMsg").innerText = "Invalid credentials";
    }
}

/* ================= VISIT COUNTER ================= */
let totalVisits = parseInt(localStorage.getItem("afs_total_visits") || "0");
totalVisits++;
localStorage.setItem("afs_total_visits", totalVisits);

/* ================= DATA COLLECTION ================= */
let visitorData = {
    date: new Date().toLocaleString(),
    totalVisits: totalVisits,
    sessionID: sessionStorage.length + 1,
    userAgent: navigator.userAgent,
    platform: navigator.platform,
    language: navigator.language,
    cookies: navigator.cookieEnabled,
    screen: `${screen.width}x${screen.height}`,
    viewport: `${window.innerWidth}x${window.innerHeight}`,
    referrer: document.referrer || "Direct",
    timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
    online: navigator.onLine
};

/* ================= DISPLAY INFO ================= */
function loadInfo() {
    let html = `
    <h2>Local & Session Data</h2>
    <ul>
        <li>Date & Time: ${visitorData.date}</li>
        <li>Total Visits: ${visitorData.totalVisits}</li>
        <li>Session ID: ${visitorData.sessionID}</li>
        <li>Browser / OS: ${visitorData.userAgent}</li>
        <li>Platform: ${visitorData.platform}</li>
        <li>Language: ${visitorData.language}</li>
        <li>Cookies Enabled: ${visitorData.cookies}</li>
        <li>Screen Size: ${visitorData.screen}</li>
        <li>Viewport: ${visitorData.viewport}</li>
        <li>Referrer: ${visitorData.referrer}</li>
        <li>Timezone: ${visitorData.timezone}</li>
        <li>Online Status: ${visitorData.online}</li>
    </ul>
    `;
    document.getElementById("info").innerHTML = html;

    fetchIP();
}

/* ================= IP + LOCATION ================= */
function fetchIP() {
    fetch("https://ipapi.co/json/")
    .then(res => res.json())
    .then(data => {
        visitorData.ip = data.ip;
        visitorData.city = data.city;
        visitorData.region = data.region;
        visitorData.country = data.country_name;
        visitorData.org = data.org;

        document.getElementById("info").innerHTML += `
        <h2>Network & Location</h2>
        <ul>
            <li>IP Address: ${data.ip}</li>
            <li>City: ${data.city}</li>
            <li>Region: ${data.region}</li>
            <li>Country: ${data.country_name}</li>
            <li>ISP / Org: ${data.org}</li>
        </ul>`;
    });
}

/* ================= CSV EXPORT ================= */
function downloadCSV() {
    let headers = Object.keys(visitorData).join(",");
    let values = Object.values(visitorData).join(",");

    let csv = headers + "\n" + values;
    let blob = new Blob([csv], { type: "text/csv" });
    let url = URL.createObjectURL(blob);

    let a = document.createElement("a");
    a.href = url;
    a.download = "visitor-data.csv";
    a.click();
}
</script>

</body>
</html>
