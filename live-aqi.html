<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Live AQI Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
margin:0;
font-family:'Segoe UI',sans-serif;
background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
color:#fff;
}

.container{
max-width:1100px;
margin:auto;
padding:30px;
}

.card{
background:rgba(255,255,255,0.12);
backdrop-filter:blur(10px);
border-radius:15px;
padding:25px;
margin-bottom:25px;
box-shadow:0 10px 30px rgba(0,0,0,.4);
}

h1,h2{text-align:center;color:#00ffcc}

input,button{
width:100%;
padding:12px;
margin-top:10px;
border-radius:8px;
border:none;
font-size:16px;
}

input{background:#fff}
button{background:#00ffcc;font-weight:bold;cursor:pointer}
button:hover{background:#00e6b8}

.aqi{font-size:32px;font-weight:bold;text-align:center}
.good{color:#00e676}
.moderate{color:#ffee58}
.poor{color:#ff7043}
.very-poor{color:#ff1744}
.severe{color:#b71c1c}

ul{list-style:none;padding:0}
li{padding:5px 0}

canvas{background:#fff;border-radius:10px;padding:10px}
</style>
</head>

<body>

<div class="container">

<div class="card">
<h1>Live AQI Dashboard</h1>

<button onclick="detectCity()">Auto Detect My City</button>

<input id="city" placeholder="Enter City (e.g., Delhi)">
<button onclick="getAQI()">Get AQI</button>

<div id="result"></div>
</div>

<div class="card">
<h2>Multi-City Comparison</h2>
<input id="city1" placeholder="City 1">
<input id="city2" placeholder="City 2">
<button onclick="compareAQI()">Compare AQI</button>
<div id="compare"></div>
</div>

<div class="card">
<h2>AQI Trend (Last 24 Hours)</h2>
<canvas id="aqiChart"></canvas>
</div>

<button onclick="window.location.href='index.html'">Back to Home</button>

</div>

<script>
const API_KEY="c0ea07d81c69c61e5bf944b8cec940c58eb4422b";
let chart;

function getAQI(cityName){
const city=cityName||document.getElementById("city").value.trim();
if(!city) return;

document.getElementById("result").innerHTML="Loading...";

fetch(`https://api.waqi.info/feed/${city}/?token=${API_KEY}`)
.then(res=>res.json())
.then(data=>{
if(data.status!=="ok"){
document.getElementById("result").innerHTML="Data unavailable";
return;
}

const aqi=data.data.aqi;
let cls="good",label="Good",health="Enjoy outdoor activities.";

if(aqi>50&&aqi<=100){cls="moderate";label="Moderate";health="Sensitive groups should reduce exertion."}
else if(aqi>100&&aqi<=200){cls="poor";label="Poor";health="People with respiratory issues avoid outdoors."}
else if(aqi>200&&aqi<=300){cls="very-poor";label="Very Poor";health="Avoid outdoor activities."}
else if(aqi>300){cls="severe";label="Severe";health="Health emergency. Stay indoors."}

document.getElementById("result").innerHTML=`
<p class="aqi ${cls}">AQI ${aqi} (${label})</p>
<ul>
<li>PM2.5: ${data.data.iaqi.pm25?.v??"N/A"}</li>
<li>PM10: ${data.data.iaqi.pm10?.v??"N/A"}</li>
<li>NO₂: ${data.data.iaqi.no2?.v??"N/A"}</li>
<li>O₃: ${data.data.iaqi.o3?.v??"N/A"}</li>
<li>CO: ${data.data.iaqi.co?.v??"N/A"}</li>
</ul>
<p><strong>Health Advisory:</strong> ${health}</p>
`;

loadChart(data.data.forecast?.daily?.pm25);
});
}

function detectCity(){
navigator.geolocation.getCurrentPosition(pos=>{
fetch(`https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${pos.coords.latitude}&longitude=${pos.coords.longitude}&localityLanguage=en`)
.then(res=>res.json())
.then(data=>{
document.getElementById("city").value=data.city||data.locality;
getAQI(data.city||data.locality);
});
});
}

function compareAQI(){
const c1=document.getElementById("city1").value.trim();
const c2=document.getElementById("city2").value.trim();
if(!c1||!c2) return;

Promise.all([
fetch(`https://api.waqi.info/feed/${c1}/?token=${API_KEY}`).then(r=>r.json()),
fetch(`https://api.waqi.info/feed/${c2}/?token=${API_KEY}`).then(r=>r.json())
]).then(([d1,d2])=>{
document.getElementById("compare").innerHTML=`
<p>${c1}: AQI ${d1.data?.aqi ?? "N/A"}</p>
<p>${c2}: AQI ${d2.data?.aqi ?? "N/A"}</p>`;
});
}

function loadChart(pm25){
if(!pm25){document.getElementById("aqiChart").style.display="none";return;}

const labels=pm25.map(d=>d.day);
const values=pm25.map(d=>d.avg);

if(chart) chart.destroy();

chart=new Chart(document.getElementById("aqiChart"),{
type:"line",
data:{
labels,
datasets:[{
label:"PM2.5 Trend",
data:values,
borderColor:"#ff5722",
fill:false
}]
}
});
}
</script>

</body>
</html>
